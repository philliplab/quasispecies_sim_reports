The following graphs and tables present a summary of a set of simulations that can be divided into `r 'fix me'` groups. 

```{r down-selection-tables, results = 'asis'}
#down_selection_for_dmats_for_kable <- down_selection_for_dmats
#
#names(down_selection_for_dmats_for_kable) <- c(
#  "Sim. ID",
#  "Group Label",
#  "Number of sequences in simulated dataset",
#  "Number of sequences included in distance matrix"
#  )
#
#kable(down_selection_for_dmats_for_kable,
#      booktabs = TRUE,
#      caption = "Number of sequences used to compute distance matrices")
```


```{r avg-hd-summary-table, results = 'asis'}

seq_length <- nchar(many_pops$arg_collection[[1]]$ancestor[1])

dcollection_to_df <- function(dcollection){
  dmat_metrics <- data.frame(sim_id = numeric(0),
                             group_label = character(0),
                             metric = character(0),
                             value = numeric(0))

  dmat_distribution_df <- NULL

  for (i in 1:length(dcollection)){
    c_dsum <- dcollection[[i]]

    decile_labels <- paste((0:10)*10, '%', sep = '')
    metric_vector <- c('avg_hd', decile_labels)

    value_vector <- c(c_dsum$avg_hd, c_dsum$perc[decile_labels])

    dmat_metrics <- rbind(dmat_metrics,
      data.frame(sim_id = c_dsum$sim_id,
                 label = c_dsum$label,
                 sampling = c_dsum$sampling,
                 group_label = paste(c_dsum$label, c_dsum$sampling, sep = '_'),
                 uniq_id = paste(c_dsum$label, c_dsum$sampling, c_dsum$sim_id, sep = '_'),
                 metric = metric_vector,
                 value = value_vector))

    dmat_distribution_df <- rbind(dmat_distribution_df,
      data.frame(sim_id = c_dsum$sim_id,
                 label = c_dsum$label,
                 sampling = c_dsum$sampling,
                 group_label = paste(c_dsum$label, c_dsum$sampling, sep = '_'),
                 uniq_id = paste(c_dsum$label, c_dsum$sampling, c_dsum$sim_id, sep = '_'),
                 x = c_dsum$dens$x,
                 y = c_dsum$dens$y
                 )
      )
  }
  return(list(dmat_metrics = dmat_metrics,
              dmat_distribution_df = dmat_distribution_df))
}

x <- dcollection_to_df(many_pops$dcollection)
dmat_metrics <- x$dmat_metrics
dmat_distribution_df = x$dmat_distribution_df

avg_hd_summary_table <- dmat_metrics %>% 
    filter(metric == 'avg_hd') %>%
    group_by(group_label) %>%
    summarize(avg_hd = mean(value),
              n_avg_hd = mean(value) / seq_length)

names(avg_hd_summary_table) <- c(
  "Label",
  "Average Pairwise HD.",
  "Normalized Average Pairwise HD.")

kable(avg_hd_summary_table,
  booktabs = TRUE,
  caption = "The average pairwise HD in each group of simulations"
)
```

```{r density-plots, fig.cap='Density plot of the pariwise distances in the last generation', results = 'asis'}
ggplot(dmat_distribution_df, aes(x = x, y = y, group = uniq_id, color = group_label)) +
  geom_smooth(se = FALSE, size = 0.75, span = 0.1, method = 'loess') + 
  guides(color = guide_legend(title = "Group Label")) +
  ylab("Density") +
  xlab("Pairwise Hamming Distance")
```

```{r deciles, results = 'asis'}
deciles <-
dmat_metrics %>% 
  filter(grepl("%$", metric)) %>%
  group_by(group_label, metric) %>%
  summarize(
    value = mean(value)
   )

ordered_perc_labels <- paste((0:10)*10, "%", sep = "")
deciles$metric <- factor(deciles$metric, ordered_perc_labels)

all_deciles <-
spread(deciles, metric, value)

kable(
  all_deciles,
  booktabs = TRUE,
  caption = "The deciles of the pairwise HDs"
)
```

```{r arguments-table, results = 'asis'}
#arg_tab <- NULL
#for (c_group_id in names(arg_sets)){
#  c_arg_tab <- sim_pop_arg_formatter(arg_sets[[c_group_id]]$args)
#  original_cols <- names(c_arg_tab)
#  c_arg_tab$group_label <- arg_sets[[c_group_id]]$group_label
#  c_arg_tab <- c_arg_tab %>% select(group_label, original_cols)
#  if (is.null(arg_tab)){
#    arg_tab <- c_arg_tab
#  } else {
#    arg_tab <- rbind(arg_tab, c_arg_tab)
#  }
#}
#for (i in 1:nrow(arg_tab)){
#  if (nchar(arg_tab$Value[i]) > 50){
#    arg_tab$Value[i] <- paste(substr(arg_tab$Value[i], 1, 50), '...', sep = '')
#  }
#}
#
#names(arg_tab)[1] <- "Group Label"
#
#kable(
#  arg_tab,
#  booktabs = TRUE,
#  caption = "Configuration with which sim_pop was called for the group for each group of simulations."
#)
```

```{r generation-summary-table, results = 'asis'}
#all_sum_tabs <- NULL
#for (c_group_label in unique(all_sim_results$group_label)){
#  g_sum_tab <- genealogy_summary_table(all_sim_results[all_sim_results$group_label == c_group_label, c(-1,-2)])
#  original_cols <- names(g_sum_tab)
#  g_sum_tab$group_label <- c_group_label
#  g_sum_tab <- g_sum_tab %>% select(group_label, original_cols)
#  if (is.null(all_sum_tabs)){
#    all_sum_tabs <- g_sum_tab
#  } else {
#    all_sum_tabs <- rbind(all_sum_tabs, g_sum_tab)
#  }
#}
#
#names(all_sum_tabs)[1] <- "Group Label"
#
#kable(
#  all_sum_tabs,
#  booktabs = TRUE,
#  caption = "Individuals per generation and the average distance to the original ancestor for the generation for all simulations grouped by simulation group."
#)
```

```{r dmat-calc-time-table, results = 'asis'}
#kable(dmat_calc_times,
#      booktabs = TRUE,
#      caption = "Computation time of the distance matrices"
#      )
```

